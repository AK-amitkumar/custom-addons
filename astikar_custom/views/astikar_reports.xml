<?xml version="1.0" encoding="UTF-8"?>
<openerp>
    <data noupdate="1">
        <report id="report_mrp_repair_order" string="Work Order"
                model="mrp.repair" report_type="qweb-pdf"
                name="astikar_custom.mrp_repair_order" />

        <report id="report_mrp_repair_picking" string="Picking"
                model="mrp.repair" report_type="qweb-pdf"
                name="astikar_custom.mrp_repair_picking" />
    </data>

    <data>
        <template id="mrp_repair_quotation" inherit_id="mrp_repair_proforma_report.report_mrprepair_proforma">
            <xpath expr="//div[@class='row']" position="replace">
                <div class="row">
                    <div class="col-xs-6 pull-right">
                        <div t-field="o.partner_id"
                            t-field-options='{"widget": "contact", "fields": ["address", "name", "phone", "fax"], "no_marker": true}' />
                              <p t-if="o.partner_id.vat">VAT: <span t-field="o.partner_id.vat"/></p>
                    </div>
                </div>
            </xpath>
            <xpath expr="//div[@class='page']/h2" position="replace">
                <h3>
                    <span t-if="o.state != 'draft' and o.proforma == False">ESKAERA ZK / PEDIDO Nº:</span>
                    <span t-if="o.state == 'draft' and o.proforma == False">AURREKONTU ZK / PRESUPUESTO Nº:</span>
                    <span t-if="o.proforma == True">Proforma ZKº:</span>
                    <span t-field="o.name"/>
                </h3>
            </xpath>
            <xpath expr="//p[@t-field='o.quotation_notes']" position="replace"/>
            <xpath expr="//div[@class='row mt32 mb32']" position="replace">
                    <div class="row mt32 mb32">
                        <div t-if="o.product_id.name" class="col-xs-9">
                            <strong>UNIDAD:</strong>
                            <span t-field="o.product_id.name"/>
                            <t t-if="o.lot_id">
                                <span t-field="o.lot_id.name"/>
                            </t>
                        </div>
                        <div class="col-xs-3 pull-right">
                            <p t-esc="time.strftime('%Y-%m-%d')"/>
                        </div>
                    </div>
                    <div>
                        <strong><p t-field="o.quotation_notes"/></strong>
                    </div>
            </xpath>
            <xpath expr="//div[@class='page']/table[@class='table table-condensed']" position="replace">
                <table class="table table-condensed">
                        <thead>
                            <tr>
                                <th>Description</th>
                                <th class="text-center">Tax</th>
                                <th class="text-right">Quantity</th>
                                <th class="text-right">Unit Price</th>
                                <th class="text-right">Price</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-if="o.operations">
                                <tr><td colspan="5"><strong>LÍNEAS DE MATERIAL</strong></td></tr>
                                <tr t-foreach="o.operations" t-as="line">
                                    <t t-if="(line.to_invoice is True)">
                                        <td>
                                            <span t-field="line.name" />
                                        </td>
                                        <td class="text-center">
                                            <span t-esc="','.join(map( lambda x: x.name, line.tax_id))"/>
                                        </td>
                                        <td class="text-right">
                                            <span t-field="line.product_uom_qty"/>
                                            <span groups="product.group_uom" t-field="line.product_uom.name"/>
                                        </td>
                                        <td class="text-right">
                                            <span t-field="line.price_unit"/>
                                        </td>
                                        <td class="text-right">
                                            <span t-field="line.price_subtotal" 
                                                t-field-options='{"widget": "monetary", "display_currency": "o.pricelist_id.currency_id"}'/>
                                       </td>
                                    </t>
                                </tr>
                            </t>
                            <t t-if="o.fees_lines">
                                <tr><td colspan="5"><strong>MANO DE OBRA</strong></td></tr>
                                <tr t-foreach="o.fees_lines" t-as="fees">
                                   <t t-if="fees.to_invoice is True">
                                        <td>
                                            <span t-field="fees.name"/>
                                        </td>
                                        <td class="text-center">
                                            <span t-esc="','.join(map( lambda x: x.name, fees.tax_id))"/>
                                        </td>
                                        <td class="text-right">
                                            <span t-field="fees.product_uom_qty"/>
                                            <span groups="product.group_uom" t-field="fees.product_uom.name"/>
                                        </td>
                                        <td class="text-right">
                                            <span t-field="fees.price_unit"/>
                                        </td>
                                        <td class="text-right">
                                            <span t-field="fees.price_subtotal"
                                                t-field-options='{"widget": "monetary", "display_currency": "o.pricelist_id.currency_id"}'/>
                                       </td>
                                   </t>
                                </tr>
                            </t>
                        </tbody>
                    </table>
            </xpath>
            <xpath expr="//div[@class='col-xs-4 pull-right']/.." position="after">
                <div class="row">
                    <p><b>NOTA:</b> Si este presupuesto es de su conformidad, agradeceríamos remitiesen el mismo con su firma de conformidad o correspondiente pedido.</p>
                </div>
                <div class="row">
                    <div class="col-xs-6">
                        CONFORME CLIENTE
                    </div>
                    <div class="col-xs-6">
                        ASTIKAR, S.A.
                        <p t-field="o.create_uid.partner_id"/>
                        <img t-if="o.company_id.logo" t-att-src="'data:image/png;base64,%s' % o.create_uid.signature_logo" style="max-height: 70px;"/>
                    </div>
                </div>
                    </xpath>
        </template>

        <template id="mrp_repair_order">
            <t t-call="report.html_container">
                <t t-foreach="docs" t-as="o">
                    <t t-call="report.external_layout">
                        <div class="page">
                            <div class="oe_structure" />
                            <div class="row">
                                <div class="text-right">
                                    <form>
                                        <h2>
                                            LAN-AGINDU ZK. <span t-field="o.name" />
                                        </h2>
                                    </form>
                                </div>
                            </div>

                            <table class="table table-condensed astikar">
                                <thead>
                                    <tr>
                                        <th>BEZERO KODEA</th>
                                        <th>BEZEROA</th>
                                        <th>I.F.K. / N.A.N.</th>
                                        <th>ORDAINTZEKO ERA</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <span
                                                t-field="o.partner_id.ref" />
                                        </td>
                                        <td>
                                            <span t-field="o.partner_id.name" />
                                        </td>
                                        <td>
                                            <span
                                                t-field="o.partner_id.vat" />
                                        </td>
                                        <td>
                                            <span
                                                t-field="o.partner_id.customer_payment_mode" />
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                            <table class="table table-condensed astikar">
                                <thead>
                                    <tr>
                                        <th>HELBIDEA</th>
                                        <th>K.P. - HERRIA</th>
                                        <th>TELEFONOA</th>
                                        <th>FAX</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <span t-field="o.partner_id.street" />
                                        </td>
                                        <td>
                                            <span t-field="o.partner_id.zip" />
                                            -
                                            <span t-field="o.partner_id.city" />
                                        </td>
                                        <td>
                                            <span t-field="o.partner_id.phone" />
                                        </td>
                                        <td>
                                            <span t-field="o.partner_id.fax" />
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <div class="text-right">
                                <span><strong>ORDU KOPURUA:</strong></span>
                                <t t-esc="sum(l.product_uom_qty for l in o.fees_lines_to_invoice)"/>
                                <span><strong>ORD. ERABILTZEKE:</strong></span>
                                <t t-esc="sum(l.product_uom_qty for l in o.fees_lines_to_invoice)- sum(l.product_uom_qty for l in o.fees_lines_no_to_invoice)"/>
                            </div>
                            <p><b>UNITATEA: <span t-field="o.product_id"/></b></p>
                            <table class="table table-condensed astikar">
                                <thead>
                                    <tr>
                                        <th>BARNE ERREFERENTZIA</th>
                                        <th>SERIE ZK/MATRIKULA</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <span t-field="o.lot_id.ref" />
                                        </td>
                                        <td>
                                            <span t-field="o.lot_id" />
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <div t-if="o.quotation_notes">
                                <p class="astikar_p">EGIN BEHARREKO LANAK</p>
                                <span t-field="o.quotation_notes" />
                            </div>
                        </div>
                            <xpath expr="//div[@class='footer']" position="replace">
                                <div class="footer">
                                    <table style="width: 100%">
                                        <thead style="background-color: #d3d3d3;">
                                            <tr>
                                                <th colspan="2" style="width:33%">PLAZO</th>
                                                <th style="width:33%">CONFORME: CLIENTE</th>
                                                <th style="width:33%">CONFORME: TALLER</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <p><strong>Fecha Inicio Trabajo: </strong></p>
                                                </td>
                                                <td>
                                                    <span t-field="o.start_date"/>
                                                </td>
                                                <td rowspan="3"></td>
                                                <td rowspan="3"><img t-if="o.create_uid.signature_logo" t-att-src="'data:image/png;base64,%s' % o.create_uid.signature_logo" style="max-width: 100%;"/></td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <p><strong>Fecha Entrega:</strong></p>
                                                </td>
                                                <td>
                                                    <span t-field="o.scheduled_departure_date"/>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <p><strong>Fecha Real Term.: </strong></p>
                                                </td>
                                                <td>
                                                    <p t-field="o.end_date"/>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </xpath>
                        <div class="oe_structure" />
                    </t>
                </t>
            </t>
        </template>


        <template id="mrp_repair_picking">
            <t t-call="report.html_container">
                <t t-foreach="docs" t-as="o">
                    <t t-call="report.external_layout">
                        <div class="page">
                            <div class="oe_structure" />

                            <div class="row">
                                <div class="col-xs-6 text-right">
                                    <p
                                        t-if="o.address_id == o.partner_invoice_id">Invoice and shipping
                                        address:</p>
                                    <p
                                        t-if="o.address_id != o.partner_invoice_id">Invoice address: </p>
                                    <div t-field="o.partner_invoice_id"
                                        t-field-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;, &quot;name&quot;, &quot;phone&quot;, &quot;fax&quot;], &quot;no_marker&quot;: true}" />
                                    <p t-if="o.partner_id.vat">
                                        VAT:
                                        <span t-field="o.partner_id.vat" />
                                    </p>
                                    <div
                                        t-if="o.address_id != o.partner_invoice_id">
                                        <p>Shipping address :</p>
                                        <div t-field="o.address_id"
                                            t-field-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;, &quot;name&quot;, &quot;phone&quot;, &quot;fax&quot;], &quot;no_marker&quot;: true}" />
                                        <p t-if="o.partner_id.vat">
                                            VAT:
                                            <span t-field="o.partner_id.vat" />
                                        </p>
                                    </div>
                                </div>
                                <div class="col-xs-5 col-xs-offset-1">
                                    <div t-field="o.partner_id"
                                        t-field-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;, &quot;name&quot;], &quot;no_marker&quot;: true}" />
                                </div>
                            </div>

                            <h2>
                                <span t-if="o.state != 'draft'">Repair Order N°:</span>
                                <span t-if="o.state == 'draft'">Repair Quotation N°:
                                </span>
                                <span t-field="o.name" />
                            </h2>

                            <div class="row mt32 mb32">
                                <div t-if="o.product_id.name" class="col-xs-4">
                                    <strong>Product to Repair:</strong>
                                    <p t-field="o.product_id.name" />
                                </div>
                                <div class="col-xs-5"
                                    groups="stock.group_production_lot">
                                    <strong>Lot Number: </strong>
                                    <t t-if="o.lot_id">
                                        <p t-field="o.lot_id.name" />
                                    </t>
                                </div>
                                <div t-if="o.guarantee_limit" class="col-xs-4">
                                    <strong>Guarantee Limit:</strong>
                                    <p t-field="o.guarantee_limit" />
                                </div>
                                <div class="col-xs-3">
                                    <strong>Printing Date:</strong>
                                    <p t-esc="time.strftime('%Y-%m-%d')" />
                                </div>
                            </div>

                            <table class="table table-condensed">
                                <thead>
                                    <tr>
                                        <th>Description</th>
                                        <th class="text-center">Tax</th>
                                        <th class="text-right">Quantity</th>
                                        <th class="text-right">Unit Price</th>
                                        <th class="text-right">Price</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-if="o.operations">
                                        <tr>
                                            <td colspan="5">
                                                <strong>Operation
                                                    Line(s)</strong>
                                            </td>
                                        </tr>
                                        <tr t-foreach="o.operations"
                                            t-as="line">
                                            <t
                                                t-if="(line.to_invoice is True)">
                                                <td>
                                                    <p
                                                        t-if="line.type == 'add'">
                                                        <i>(Add)</i>
                                                        <span
                                                            t-field="line.name" />
                                                    </p>
                                                    <p
                                                        t-if="line.type == 'remove'">
                                                        (
                                                        <i>Remove</i>
                                                        )
                                                        <span
                                                            t-field="line.name" />
                                                    </p>
                                                </td>
                                                <td class="text-center">
                                                    <span
                                                        t-esc="','.join(map( lambda x: x.name, line.tax_id))" />
                                                </td>
                                                <td class="text-right">
                                                    <span
                                                        t-field="line.product_uom_qty" />
                                                    <span
                                                        groups="product.group_uom"
                                                        t-field="line.product_uom.name" />
                                                </td>
                                                <td class="text-right">
                                                    <span
                                                        t-field="line.price_unit" />
                                                </td>
                                                <td class="text-right">
                                                    <span
                                                        t-field="line.price_subtotal"
                                                        t-field-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: &quot;o.pricelist_id.currency_id&quot;}" />
                                                </td>
                                            </t>
                                        </tr>
                                    </t>
                                    <t t-if="o.fees_lines">
                                        <tr>
                                            <td colspan="5">
                                                <strong>Fees Line(s)
                                                </strong>
                                            </td>
                                        </tr>
                                        <tr t-foreach="o.fees_lines"
                                            t-as="fees">
                                            <t t-if="fees.to_invoice is True">
                                                <td>
                                                    <span t-field="fees.name" />
                                                </td>
                                                <td class="text-center">
                                                    <span
                                                        t-esc="','.join(map( lambda x: x.name, fees.tax_id))" />
                                                </td>
                                                <td class="text-right">
                                                    <span
                                                        t-field="fees.product_uom_qty" />
                                                    <span
                                                        groups="product.group_uom"
                                                        t-field="fees.product_uom.name" />
                                                </td>
                                                <td class="text-right">
                                                    <span
                                                        t-field="fees.price_unit" />
                                                </td>
                                                <td class="text-right">
                                                    <span
                                                        t-field="fees.price_subtotal"
                                                        t-field-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: &quot;o.pricelist_id.currency_id&quot;}" />
                                                </td>
                                            </t>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>

                            <div class="row">
                                <div class="col-xs-4 pull-right">
                                    <table class="table table-condensed">
                                        <tr class="border-black">
                                            <td>
                                                <strong>Total Without
                                                    Taxes</strong>
                                            </td>
                                            <td class="text-right">
                                                <span t-field="o.amount_untaxed"
                                                    t-field-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: &quot;o.pricelist_id.currency_id&quot;}" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Taxes</td>
                                            <td class="text-right">
                                                <span t-field="o.amount_tax"
                                                    t-field-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: &quot;o.pricelist_id.currency_id&quot;}" />
                                            </td>
                                        </tr>
                                        <tr class="border-black">
                                            <td>
                                                <strong>Total</strong>
                                            </td>
                                            <td class="text-right">
                                                <span t-field="o.amount_total"
                                                    t-field-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: &quot;o.pricelist_id.currency_id&quot;}" />
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>

                            <p t-field="o.quotation_notes" />
                            <div class="oe_structure" />
                        </div>
                    </t>
                </t>
            </t>
        </template>
    </data>

</openerp>
